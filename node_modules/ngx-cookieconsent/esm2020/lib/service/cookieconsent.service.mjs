import { Injectable } from '@angular/core';
import { Subject } from 'rxjs';
import { NgcCookieConsentConfig } from './cookieconsent-config';
import { WindowService } from './window.service';
import * as i0 from "@angular/core";
import * as i1 from "./window.service";
import * as i2 from "./cookieconsent-config";
/**
 * Service to interact with Cookie Consent API.
 */
export class NgcCookieConsentService {
    constructor(windowService, config) {
        // Observable  sources
        this.popupOpenSource = new Subject();
        this.popupCloseSource = new Subject();
        this.initializingSource = new Subject();
        this.initializedSource = new Subject();
        this.initializationErrorSource = new Subject();
        this.statusChangeSource = new Subject();
        this.revokeChoiceSource = new Subject();
        this.noCookieLawSource = new Subject();
        // Observable  streams
        this.popupOpen$ = this.popupOpenSource.asObservable();
        this.popupClose$ = this.popupCloseSource.asObservable();
        this.initializing$ = this.initializingSource.asObservable();
        this.initialized$ = this.initializedSource.asObservable();
        this.initializationError$ = this.initializationErrorSource.asObservable();
        this.statusChange$ = this.statusChangeSource.asObservable();
        this.revokeChoice$ = this.revokeChoiceSource.asObservable();
        this.noCookieLaw$ = this.noCookieLawSource.asObservable();
        this.window = windowService.nativeWindow;
        this.init(config);
    }
    checkPopupInstantiated(method) {
        if (this.popupInstance == null) {
            throw new Error(`Cookie popup has not yet been instantiated. Cannot invoke ${method}()`);
        }
    }
    /**
     * Initializes Cookie Consent with the provided configuration.
     * @param config the configuration object
     */
    init(config) {
        if (this.window && this.window.cookieconsent) { // For Angular Universal suport
            this.cookieconsent = this.window.cookieconsent;
            this.config = config;
            // Set callbacks hooks:
            this.config.onPopupOpen =
                () => this.popupOpenSource.next();
            this.config.onPopupClose =
                () => this.popupCloseSource.next();
            this.config.onInitialise =
                (status) => this.initializingSource.next({ status: status });
            this.config.onStatusChange =
                (status, chosenBefore) => {
                    this.statusChangeSource.next({ status: status, chosenBefore: chosenBefore });
                };
            this.config.onRevokeChoice =
                () => this.revokeChoiceSource.next();
            this.config.onNoCookieLaw =
                (countryCode, country) => {
                    this.noCookieLawSource.next({ countryCode: countryCode, country: country });
                };
            // Init the cookieconsent library with injected config
            this.cookieconsent.initialise(this.config, (popup) => {
                this.popupInstance = popup;
                this.initializedSource.next(); //notify of successful initialization
            }, (error, popup) => {
                this.initializationErrorSource.next({ error: error }); //notify of failed initialization
            });
        }
    }
    /**
     * Gets the current configuration  used by the Cookie Consent.
     */
    getConfig() {
        return this.config;
    }
    /**
     * Gets the current cookie status.
     */
    getStatus() {
        return this.cookieconsent.status;
    }
    /**
     * Gets the current browser support for translations
     */
    getTransition() {
        return this.cookieconsent.hasTransition;
    }
    /**
     * Clears the current cookie status.
     */
    clearStatus() {
        this.checkPopupInstantiated('clearStatus');
        return this.popupInstance.clearStatus();
    }
    open() {
        this.checkPopupInstantiated('open');
        return this.popupInstance.open();
    }
    close(showRevoke) {
        this.checkPopupInstantiated('close');
        return this.popupInstance.close(showRevoke);
    }
    destroy() {
        this.checkPopupInstantiated('destroy');
        this.popupInstance.destroy();
    }
    fadeIn() {
        this.checkPopupInstantiated('fadeIn');
        this.popupInstance.fadeIn();
    }
    fadeOut() {
        this.checkPopupInstantiated('fadeOut');
        this.popupInstance.fadeOut();
    }
    isOpen() {
        this.checkPopupInstantiated('isOpen');
        return this.popupInstance.isOpen();
    }
    toggleRevokeButton(show) {
        this.checkPopupInstantiated('toggleRevokeButton');
        this.popupInstance.toggleRevokeButton(show);
    }
    hasAnswered() {
        this.checkPopupInstantiated('hasAnswered');
        return this.popupInstance.hasAnswered();
    }
    hasConsented() {
        this.checkPopupInstantiated('hasConsented');
        return this.popupInstance.hasConsented();
    }
}
NgcCookieConsentService.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "14.2.5", ngImport: i0, type: NgcCookieConsentService, deps: [{ token: i1.WindowService }, { token: i2.NgcCookieConsentConfig }], target: i0.ɵɵFactoryTarget.Injectable });
NgcCookieConsentService.ɵprov = i0.ɵɵngDeclareInjectable({ minVersion: "12.0.0", version: "14.2.5", ngImport: i0, type: NgcCookieConsentService });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "14.2.5", ngImport: i0, type: NgcCookieConsentService, decorators: [{
            type: Injectable
        }], ctorParameters: function () { return [{ type: i1.WindowService }, { type: i2.NgcCookieConsentConfig }]; } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29va2llY29uc2VudC5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vbGlicy9uZ3gtY29va2llY29uc2VudC9zcmMvbGliL3NlcnZpY2UvY29va2llY29uc2VudC5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDM0MsT0FBTyxFQUFFLE9BQU8sRUFBYyxNQUFNLE1BQU0sQ0FBQztBQU8zQyxPQUFPLEVBQUUsc0JBQXNCLEVBQUUsTUFBTSx3QkFBd0IsQ0FBQztBQUNoRSxPQUFPLEVBQUUsYUFBYSxFQUFFLE1BQU0sa0JBQWtCLENBQUM7Ozs7QUF5Q2pEOztHQUVHO0FBRUgsTUFBTSxPQUFPLHVCQUF1QjtJQXlEbEMsWUFBWSxhQUE0QixFQUFFLE1BQThCO1FBQ3RFLHNCQUFzQjtRQUN0QixJQUFJLENBQUMsZUFBZSxHQUFHLElBQUksT0FBTyxFQUFRLENBQUM7UUFDM0MsSUFBSSxDQUFDLGdCQUFnQixHQUFHLElBQUksT0FBTyxFQUFRLENBQUM7UUFDNUMsSUFBSSxDQUFDLGtCQUFrQixHQUFHLElBQUksT0FBTyxFQUF3QixDQUFDO1FBQzlELElBQUksQ0FBQyxpQkFBaUIsR0FBRyxJQUFJLE9BQU8sRUFBUSxDQUFDO1FBQzdDLElBQUksQ0FBQyx5QkFBeUIsR0FBRyxJQUFJLE9BQU8sRUFBK0IsQ0FBQztRQUM1RSxJQUFJLENBQUMsa0JBQWtCLEdBQUcsSUFBSSxPQUFPLEVBQXdCLENBQUM7UUFDOUQsSUFBSSxDQUFDLGtCQUFrQixHQUFHLElBQUksT0FBTyxFQUFRLENBQUM7UUFDOUMsSUFBSSxDQUFDLGlCQUFpQixHQUFHLElBQUksT0FBTyxFQUF1QixDQUFDO1FBRTVELHNCQUFzQjtRQUN0QixJQUFJLENBQUMsVUFBVSxHQUFHLElBQUksQ0FBQyxlQUFlLENBQUMsWUFBWSxFQUFFLENBQUM7UUFDdEQsSUFBSSxDQUFDLFdBQVcsR0FBRyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsWUFBWSxFQUFFLENBQUM7UUFDeEQsSUFBSSxDQUFDLGFBQWEsR0FBRyxJQUFJLENBQUMsa0JBQWtCLENBQUMsWUFBWSxFQUFFLENBQUM7UUFDNUQsSUFBSSxDQUFDLFlBQVksR0FBRyxJQUFJLENBQUMsaUJBQWlCLENBQUMsWUFBWSxFQUFFLENBQUM7UUFDMUQsSUFBSSxDQUFDLG9CQUFvQixHQUFHLElBQUksQ0FBQyx5QkFBeUIsQ0FBQyxZQUFZLEVBQUUsQ0FBQztRQUMxRSxJQUFJLENBQUMsYUFBYSxHQUFHLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxZQUFZLEVBQUUsQ0FBQztRQUM1RCxJQUFJLENBQUMsYUFBYSxHQUFHLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxZQUFZLEVBQUUsQ0FBQztRQUM1RCxJQUFJLENBQUMsWUFBWSxHQUFHLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxZQUFZLEVBQUUsQ0FBQztRQUUxRCxJQUFJLENBQUMsTUFBTSxHQUFHLGFBQWEsQ0FBQyxZQUFZLENBQUM7UUFDekMsSUFBSSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQztJQUNwQixDQUFDO0lBRU8sc0JBQXNCLENBQUMsTUFBYztRQUMzQyxJQUFJLElBQUksQ0FBQyxhQUFhLElBQUksSUFBSSxFQUFFO1lBQzlCLE1BQU0sSUFBSSxLQUFLLENBQUMsNkRBQTZELE1BQU0sSUFBSSxDQUFDLENBQUM7U0FDMUY7SUFDSCxDQUFDO0lBRUQ7OztPQUdHO0lBQ0gsSUFBSSxDQUFDLE1BQThCO1FBRWpDLElBQUksSUFBSSxDQUFDLE1BQU0sSUFBSSxJQUFJLENBQUMsTUFBTSxDQUFDLGFBQWEsRUFBRSxFQUFFLCtCQUErQjtZQUM3RSxJQUFJLENBQUMsYUFBYSxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsYUFBYSxDQUFDO1lBRS9DLElBQUksQ0FBQyxNQUFNLEdBQUcsTUFBTSxDQUFDO1lBQ3JCLHVCQUF1QjtZQUN2QixJQUFJLENBQUMsTUFBTSxDQUFDLFdBQVc7Z0JBQ3JCLEdBQUcsRUFBRSxDQUFDLElBQUksQ0FBQyxlQUFlLENBQUMsSUFBSSxFQUFFLENBQUM7WUFFcEMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxZQUFZO2dCQUN0QixHQUFHLEVBQUUsQ0FBQyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsSUFBSSxFQUFFLENBQUM7WUFFckMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxZQUFZO2dCQUN0QixDQUFDLE1BQW9DLEVBQUUsRUFBRSxDQUFDLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxJQUFJLENBQUMsRUFBRSxNQUFNLEVBQUUsTUFBTSxFQUFFLENBQUMsQ0FBQztZQUU3RixJQUFJLENBQUMsTUFBTSxDQUFDLGNBQWM7Z0JBQ3hCLENBQUMsTUFBb0MsRUFBRSxZQUFxQixFQUFFLEVBQUU7b0JBQzlELElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxJQUFJLENBQUMsRUFBRSxNQUFNLEVBQUUsTUFBTSxFQUFFLFlBQVksRUFBRSxZQUFZLEVBQUUsQ0FBQyxDQUFDO2dCQUMvRSxDQUFDLENBQUM7WUFFSixJQUFJLENBQUMsTUFBTSxDQUFDLGNBQWM7Z0JBQ3hCLEdBQUcsRUFBRSxDQUFDLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxJQUFJLEVBQUUsQ0FBQztZQUV2QyxJQUFJLENBQUMsTUFBTSxDQUFDLGFBQWE7Z0JBQ3ZCLENBQUMsV0FBbUIsRUFBRSxPQUFlLEVBQUUsRUFBRTtvQkFDdkMsSUFBSSxDQUFDLGlCQUFpQixDQUFDLElBQUksQ0FBQyxFQUFFLFdBQVcsRUFBRSxXQUFXLEVBQUUsT0FBTyxFQUFFLE9BQU8sRUFBRSxDQUFDLENBQUM7Z0JBQzlFLENBQUMsQ0FBQztZQUVKLHNEQUFzRDtZQUN0RCxJQUFJLENBQUMsYUFBYSxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUN2QyxDQUFDLEtBQTRCLEVBQUUsRUFBRTtnQkFDL0IsSUFBSSxDQUFDLGFBQWEsR0FBRyxLQUFLLENBQUM7Z0JBQzNCLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFBLHFDQUFxQztZQUNyRSxDQUFDLEVBQ0QsQ0FBQyxLQUFZLEVBQUUsS0FBNEIsRUFBRSxFQUFFO2dCQUM3QyxJQUFJLENBQUMseUJBQXlCLENBQUMsSUFBSSxDQUFDLEVBQUMsS0FBSyxFQUFFLEtBQUssRUFBQyxDQUFDLENBQUMsQ0FBQSxpQ0FBaUM7WUFDdkYsQ0FBQyxDQUNGLENBQUM7U0FDSDtJQUNILENBQUM7SUFFRDs7T0FFRztJQUNILFNBQVM7UUFDUCxPQUFPLElBQUksQ0FBQyxNQUFNLENBQUM7SUFDckIsQ0FBQztJQUVEOztPQUVHO0lBQ0gsU0FBUztRQUNQLE9BQU8sSUFBSSxDQUFDLGFBQWEsQ0FBQyxNQUFNLENBQUM7SUFDbkMsQ0FBQztJQUVEOztPQUVHO0lBQ0gsYUFBYTtRQUNYLE9BQU8sSUFBSSxDQUFDLGFBQWEsQ0FBQyxhQUFhLENBQUM7SUFDMUMsQ0FBQztJQUVEOztPQUVHO0lBQ0gsV0FBVztRQUNULElBQUksQ0FBQyxzQkFBc0IsQ0FBQyxhQUFhLENBQUMsQ0FBQztRQUMzQyxPQUFPLElBQUksQ0FBQyxhQUFhLENBQUMsV0FBVyxFQUFFLENBQUM7SUFDMUMsQ0FBQztJQUVELElBQUk7UUFDRixJQUFJLENBQUMsc0JBQXNCLENBQUMsTUFBTSxDQUFDLENBQUM7UUFDcEMsT0FBTyxJQUFJLENBQUMsYUFBYSxDQUFDLElBQUksRUFBRSxDQUFDO0lBQ25DLENBQUM7SUFFRCxLQUFLLENBQUMsVUFBbUI7UUFDdkIsSUFBSSxDQUFDLHNCQUFzQixDQUFDLE9BQU8sQ0FBQyxDQUFDO1FBQ3JDLE9BQU8sSUFBSSxDQUFDLGFBQWEsQ0FBQyxLQUFLLENBQUMsVUFBVSxDQUFDLENBQUM7SUFDOUMsQ0FBQztJQUVELE9BQU87UUFDTCxJQUFJLENBQUMsc0JBQXNCLENBQUMsU0FBUyxDQUFDLENBQUM7UUFDdkMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxPQUFPLEVBQUUsQ0FBQztJQUMvQixDQUFDO0lBRUQsTUFBTTtRQUNKLElBQUksQ0FBQyxzQkFBc0IsQ0FBQyxRQUFRLENBQUMsQ0FBQztRQUN0QyxJQUFJLENBQUMsYUFBYSxDQUFDLE1BQU0sRUFBRSxDQUFDO0lBQzlCLENBQUM7SUFFRCxPQUFPO1FBQ0wsSUFBSSxDQUFDLHNCQUFzQixDQUFDLFNBQVMsQ0FBQyxDQUFDO1FBQ3ZDLElBQUksQ0FBQyxhQUFhLENBQUMsT0FBTyxFQUFFLENBQUM7SUFDL0IsQ0FBQztJQUVELE1BQU07UUFDSixJQUFJLENBQUMsc0JBQXNCLENBQUMsUUFBUSxDQUFDLENBQUM7UUFDdEMsT0FBTyxJQUFJLENBQUMsYUFBYSxDQUFDLE1BQU0sRUFBRSxDQUFDO0lBQ3JDLENBQUM7SUFFRCxrQkFBa0IsQ0FBQyxJQUFhO1FBQzlCLElBQUksQ0FBQyxzQkFBc0IsQ0FBQyxvQkFBb0IsQ0FBQyxDQUFDO1FBQ2xELElBQUksQ0FBQyxhQUFhLENBQUMsa0JBQWtCLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDOUMsQ0FBQztJQUVELFdBQVc7UUFDVCxJQUFJLENBQUMsc0JBQXNCLENBQUMsYUFBYSxDQUFDLENBQUM7UUFDM0MsT0FBTyxJQUFJLENBQUMsYUFBYSxDQUFDLFdBQVcsRUFBRSxDQUFDO0lBQzFDLENBQUM7SUFFRCxZQUFZO1FBQ1YsSUFBSSxDQUFDLHNCQUFzQixDQUFDLGNBQWMsQ0FBQyxDQUFDO1FBQzVDLE9BQU8sSUFBSSxDQUFDLGFBQWEsQ0FBQyxZQUFZLEVBQUUsQ0FBQztJQUMzQyxDQUFDOztvSEE5TVUsdUJBQXVCO3dIQUF2Qix1QkFBdUI7MkZBQXZCLHVCQUF1QjtrQkFEbkMsVUFBVSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEluamVjdGFibGUgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IFN1YmplY3QsIE9ic2VydmFibGUgfSBmcm9tICdyeGpzJztcblxuaW1wb3J0IHsgTmdjQ29va2llQ29uc2VudFN0YXR1cyB9IGZyb20gJy4uL21vZGVsL2NvbW1vbi1pbnRlcmZhY2VzJztcbmltcG9ydCB7IE5nY1N0YXR1c0NoYW5nZUV2ZW50IH0gZnJvbSAnLi4vZXZlbnQvc3RhdHVzLWNoYW5nZS5ldmVudCc7XG5pbXBvcnQgeyBOZ2NOb0Nvb2tpZUxhd0V2ZW50IH0gZnJvbSAnLi4vZXZlbnQvbm8tY29va2llLWxhdy5ldmVudCc7XG5pbXBvcnQgeyBOZ2NJbml0aWFsaXppbmdFdmVudCB9IGZyb20gJy4uL2V2ZW50L2luaXRpYWxpemluZy5ldmVudCc7XG5pbXBvcnQgeyBOZ2NJbml0aWFsaXphdGlvbkVycm9yRXZlbnQgfSBmcm9tICcuLi9ldmVudCc7XG5pbXBvcnQgeyBOZ2NDb29raWVDb25zZW50Q29uZmlnIH0gZnJvbSAnLi9jb29raWVjb25zZW50LWNvbmZpZyc7XG5pbXBvcnQgeyBXaW5kb3dTZXJ2aWNlIH0gZnJvbSAnLi93aW5kb3cuc2VydmljZSc7XG5cblxuLyoqXG4gKiBCYXNpYyBpbnRlcmZhY2UgdG8gcmVwcmVzZW50IGBjb29raWVjb25zZW50YCBvYmplY3QuXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgTmdjQ29va2llQ29uc2VudCB7XG4gIGhhc1RyYW5zaXRpb246IGJvb2xlYW47XG4gIHN0YXR1czogTmdjQ29va2llQ29uc2VudFN0YXR1cztcbiAgZ2V0U3RhdHVzKCk6IE5nY0Nvb2tpZUNvbnNlbnRTdGF0dXM7XG4gIGluaXRpYWxpc2UoY29uZmlnOiBOZ2NDb29raWVDb25zZW50Q29uZmlnLCBzdWNjZXNzQ2FsbGJhY2s/OiAocG9wdXA6IE5nY0Nvb2tpZUNvbnNlbnRQb3B1cCkgPT4gdm9pZCwgZXJyb3JDYWxsYmFjaz86IChlcnJvcjogRXJyb3IsIHBvcHVwOiBOZ2NDb29raWVDb25zZW50UG9wdXApID0+IHZvaWQpOiB2b2lkO1xuXG59XG5cbi8qKlxuICogQmFzaWMgaW50ZXJmYWNlIHRvIHJlcHJlc2VudCBgY29va2llY29uc2VudC5Qb3B1cGAgb2JqZWN0LlxuICovXG5leHBvcnQgaW50ZXJmYWNlIE5nY0Nvb2tpZUNvbnNlbnRQb3B1cCB7XG4gIHNldFN0YXR1cyhzdGF0dXM6IE5nY0Nvb2tpZUNvbnNlbnRTdGF0dXMpOiB2b2lkO1xuICBnZXRTdGF0dXMoKTogTmdjQ29va2llQ29uc2VudFN0YXR1cztcbiAgY2xlYXJTdGF0dXMoKTogdm9pZDtcbiAgb3BlbigpOiBOZ2NDb29raWVDb25zZW50UG9wdXA7XG4gIGNsb3NlKHNob3dSZXZva2U6IGJvb2xlYW4pOiBOZ2NDb29raWVDb25zZW50UG9wdXA7XG4gIGRlc3Ryb3koKTogdm9pZDtcbiAgZmFkZUluKCk6IHZvaWQ7XG4gIGZhZGVPdXQoKTogdm9pZDtcbiAgaXNPcGVuKCk6IGJvb2xlYW47XG4gIHRvZ2dsZVJldm9rZUJ1dHRvbihzaG93OiBib29sZWFuKTogdm9pZDtcbiAgaGFzQW5zd2VyZWQoKTogYm9vbGVhbjtcbiAgaGFzQ29uc2VudGVkKCk6IGJvb2xlYW47XG59XG5cblxuLyoqXG4gKiBNYXJrZXIgaW50ZXJmYWNlIHRvIGluZGljYXRlIHRoYXQgYW4gb2JqZWN0ICh0eXBpY2FsbHkgYHdpbmRvd2ApIGhhcyBgY29va2llY29uc2VudGAgcHJvcGVydHkuXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgTmdjSGFzQ29va2llQ29uc2VudCB7XG4gIGNvb2tpZWNvbnNlbnQ6IE5nY0Nvb2tpZUNvbnNlbnQ7XG59XG5cblxuLyoqXG4gKiBTZXJ2aWNlIHRvIGludGVyYWN0IHdpdGggQ29va2llIENvbnNlbnQgQVBJLlxuICovXG5ASW5qZWN0YWJsZSgpXG5leHBvcnQgY2xhc3MgTmdjQ29va2llQ29uc2VudFNlcnZpY2Uge1xuXG4gIC8vIHRoZSBNYWdpYyBNYWtlciAhXG4gIC8vIHRoaXMgb2JqZXQgaXMgYWRkZWQgdG8gd2luZG93IHNjb3BlIHdoZW4gbGlua2luZyB0aGUgY29va2llY29uc2VudC5qcyBsaWJyYXJ5XG4gIHByaXZhdGUgY29va2llY29uc2VudCE6IE5nY0Nvb2tpZUNvbnNlbnQ7XG5cbiAgLy8gdGhlIGN1cnJlbnQgaW5zdGFuY2Ugb2YgdGhlIGNvb2tpZSBjb25zZW50IHBvcHVwXG4gIHByaXZhdGUgcG9wdXBJbnN0YW5jZSE6IE5nY0Nvb2tpZUNvbnNlbnRQb3B1cDtcblxuICAvLyBXaW5kb3cgT2JqZWN0XG4gIHByaXZhdGUgd2luZG93OiBXaW5kb3cgJiBOZ2NIYXNDb29raWVDb25zZW50O1xuXG4gIHByaXZhdGUgY29uZmlnITogTmdjQ29va2llQ29uc2VudENvbmZpZztcblxuICAvLyBPYnNlcnZhYmxlICBzb3VyY2VzXG4gIHByaXZhdGUgcG9wdXBPcGVuU291cmNlOiBTdWJqZWN0PHZvaWQ+O1xuICBwcml2YXRlIHBvcHVwQ2xvc2VTb3VyY2U6IFN1YmplY3Q8dm9pZD47XG4gIHByaXZhdGUgaW5pdGlhbGl6aW5nU291cmNlOiBTdWJqZWN0PE5nY0luaXRpYWxpemluZ0V2ZW50PjtcbiAgcHJpdmF0ZSBpbml0aWFsaXplZFNvdXJjZTogU3ViamVjdDx2b2lkPjtcbiAgcHJpdmF0ZSBpbml0aWFsaXphdGlvbkVycm9yU291cmNlOiBTdWJqZWN0PE5nY0luaXRpYWxpemF0aW9uRXJyb3JFdmVudD47XG4gIHByaXZhdGUgc3RhdHVzQ2hhbmdlU291cmNlOiBTdWJqZWN0PE5nY1N0YXR1c0NoYW5nZUV2ZW50PjtcbiAgcHJpdmF0ZSByZXZva2VDaG9pY2VTb3VyY2U6IFN1YmplY3Q8dm9pZD47XG4gIHByaXZhdGUgbm9Db29raWVMYXdTb3VyY2U6IFN1YmplY3Q8TmdjTm9Db29raWVMYXdFdmVudD47XG5cbiAgLyoqXG4gICAqIE9ic2VydmFibGUgdG8gc3Vic2NyaWJlIHRvIGFuZCBnZXQgbm90aWZpZWQgd2hlbiBDb29raWUgQ29uc2VudCBwb3B1cCBvcGVucy5cbiAgICovXG4gIHBvcHVwT3BlbiQ6IE9ic2VydmFibGU8dm9pZD47XG4gIC8qKlxuICAgKiBPYnNlcnZhYmxlIHRvIHN1YnNjcmliZSB0byBhbmQgZ2V0IG5vdGlmaWVkIHdoZW4gQ29va2llIENvbnNlbnQgcG9wdXAgY2xvc2VzLlxuICAgKi9cbiAgcG9wdXBDbG9zZSQ6IE9ic2VydmFibGU8dm9pZD47XG4gIC8qKlxuICAgKiBPYnNlcnZhYmxlIHRvIHN1YnNjcmliZSB0byBhbmQgZ2V0IG5vdGlmaWVkIHdoZW4gQ29va2llIENvbnNlbnQgaXMgaW5pdGlhbGl6aW5nLlxuICAgKi9cbiAgaW5pdGlhbGl6aW5nJDogT2JzZXJ2YWJsZTxOZ2NJbml0aWFsaXppbmdFdmVudD47XG4gIC8qKlxuICAgKiBPYnNlcnZhYmxlIHRvIHN1YnNjcmliZSB0byBhbmQgZ2V0IG5vdGlmaWVkIHdoZW4gQ29va2llIENvbnNlbnQgaGFzIGJlZW4gc3VjY2Vzc2Z1bGx5IGluaXRpYWxpemVkLlxuICAgKi9cbiAgaW5pdGlhbGl6ZWQkOiBPYnNlcnZhYmxlPHZvaWQ+O1xuICAvKipcbiAgICogT2JzZXJ2YWJsZSB0byBzdWJzY3JpYmUgdG8gYW5kIGdldCBub3RpZmllZCB3aGVuIENvb2tpZSBDb25zZW50IGhhcyBmYWlsZWQgdG8gaW5pdGlhbGl6ZS5cbiAgICovXG4gIGluaXRpYWxpemF0aW9uRXJyb3IkOiBPYnNlcnZhYmxlPE5nY0luaXRpYWxpemF0aW9uRXJyb3JFdmVudD47XG4gIC8qKlxuICAqIE9ic2VydmFibGUgdG8gc3Vic2NyaWJlIHRvIGFuZCBnZXQgbm90aWZpZWQgd2hlbiBDb29raWUgQ29uc2VudCBzdGF0dXMgY2hhbmdlcy5cbiAgKi9cbiAgc3RhdHVzQ2hhbmdlJDogT2JzZXJ2YWJsZTxOZ2NTdGF0dXNDaGFuZ2VFdmVudD47XG4gIC8qKlxuICAgKiBPYnNlcnZhYmxlIHRvIHN1YnNjcmliZSB0byBhbmQgZ2V0IG5vdGlmaWVkIHdoZW4gQ29va2llIGlzIHJldm9rZWQuXG4gICAqL1xuICByZXZva2VDaG9pY2UkOiBPYnNlcnZhYmxlPHZvaWQ+O1xuICAvKipcbiAgKiBPYnNlcnZhYmxlIHRvIHN1YnNjcmliZSB0byBhbmQgZ2V0IG5vdGlmaWVkIHdoZW4gbm8gQ29va2llIExhdyBpcyBhcHBsaWNhYmxlLlxuICAqL1xuICBub0Nvb2tpZUxhdyQ6IE9ic2VydmFibGU8TmdjTm9Db29raWVMYXdFdmVudD47XG5cbiAgY29uc3RydWN0b3Iod2luZG93U2VydmljZTogV2luZG93U2VydmljZSwgY29uZmlnOiBOZ2NDb29raWVDb25zZW50Q29uZmlnKSB7XG4gICAgLy8gT2JzZXJ2YWJsZSAgc291cmNlc1xuICAgIHRoaXMucG9wdXBPcGVuU291cmNlID0gbmV3IFN1YmplY3Q8dm9pZD4oKTtcbiAgICB0aGlzLnBvcHVwQ2xvc2VTb3VyY2UgPSBuZXcgU3ViamVjdDx2b2lkPigpO1xuICAgIHRoaXMuaW5pdGlhbGl6aW5nU291cmNlID0gbmV3IFN1YmplY3Q8TmdjSW5pdGlhbGl6aW5nRXZlbnQ+KCk7XG4gICAgdGhpcy5pbml0aWFsaXplZFNvdXJjZSA9IG5ldyBTdWJqZWN0PHZvaWQ+KCk7XG4gICAgdGhpcy5pbml0aWFsaXphdGlvbkVycm9yU291cmNlID0gbmV3IFN1YmplY3Q8TmdjSW5pdGlhbGl6YXRpb25FcnJvckV2ZW50PigpO1xuICAgIHRoaXMuc3RhdHVzQ2hhbmdlU291cmNlID0gbmV3IFN1YmplY3Q8TmdjU3RhdHVzQ2hhbmdlRXZlbnQ+KCk7XG4gICAgdGhpcy5yZXZva2VDaG9pY2VTb3VyY2UgPSBuZXcgU3ViamVjdDx2b2lkPigpO1xuICAgIHRoaXMubm9Db29raWVMYXdTb3VyY2UgPSBuZXcgU3ViamVjdDxOZ2NOb0Nvb2tpZUxhd0V2ZW50PigpO1xuXG4gICAgLy8gT2JzZXJ2YWJsZSAgc3RyZWFtc1xuICAgIHRoaXMucG9wdXBPcGVuJCA9IHRoaXMucG9wdXBPcGVuU291cmNlLmFzT2JzZXJ2YWJsZSgpO1xuICAgIHRoaXMucG9wdXBDbG9zZSQgPSB0aGlzLnBvcHVwQ2xvc2VTb3VyY2UuYXNPYnNlcnZhYmxlKCk7XG4gICAgdGhpcy5pbml0aWFsaXppbmckID0gdGhpcy5pbml0aWFsaXppbmdTb3VyY2UuYXNPYnNlcnZhYmxlKCk7XG4gICAgdGhpcy5pbml0aWFsaXplZCQgPSB0aGlzLmluaXRpYWxpemVkU291cmNlLmFzT2JzZXJ2YWJsZSgpO1xuICAgIHRoaXMuaW5pdGlhbGl6YXRpb25FcnJvciQgPSB0aGlzLmluaXRpYWxpemF0aW9uRXJyb3JTb3VyY2UuYXNPYnNlcnZhYmxlKCk7XG4gICAgdGhpcy5zdGF0dXNDaGFuZ2UkID0gdGhpcy5zdGF0dXNDaGFuZ2VTb3VyY2UuYXNPYnNlcnZhYmxlKCk7XG4gICAgdGhpcy5yZXZva2VDaG9pY2UkID0gdGhpcy5yZXZva2VDaG9pY2VTb3VyY2UuYXNPYnNlcnZhYmxlKCk7XG4gICAgdGhpcy5ub0Nvb2tpZUxhdyQgPSB0aGlzLm5vQ29va2llTGF3U291cmNlLmFzT2JzZXJ2YWJsZSgpO1xuXG4gICAgdGhpcy53aW5kb3cgPSB3aW5kb3dTZXJ2aWNlLm5hdGl2ZVdpbmRvdztcbiAgICB0aGlzLmluaXQoY29uZmlnKTtcbiAgfVxuXG4gIHByaXZhdGUgY2hlY2tQb3B1cEluc3RhbnRpYXRlZChtZXRob2Q6IHN0cmluZykge1xuICAgIGlmICh0aGlzLnBvcHVwSW5zdGFuY2UgPT0gbnVsbCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBDb29raWUgcG9wdXAgaGFzIG5vdCB5ZXQgYmVlbiBpbnN0YW50aWF0ZWQuIENhbm5vdCBpbnZva2UgJHttZXRob2R9KClgKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogSW5pdGlhbGl6ZXMgQ29va2llIENvbnNlbnQgd2l0aCB0aGUgcHJvdmlkZWQgY29uZmlndXJhdGlvbi5cbiAgICogQHBhcmFtIGNvbmZpZyB0aGUgY29uZmlndXJhdGlvbiBvYmplY3RcbiAgICovXG4gIGluaXQoY29uZmlnOiBOZ2NDb29raWVDb25zZW50Q29uZmlnKTogdm9pZCB7XG5cbiAgICBpZiAodGhpcy53aW5kb3cgJiYgdGhpcy53aW5kb3cuY29va2llY29uc2VudCkgeyAvLyBGb3IgQW5ndWxhciBVbml2ZXJzYWwgc3Vwb3J0XG4gICAgICB0aGlzLmNvb2tpZWNvbnNlbnQgPSB0aGlzLndpbmRvdy5jb29raWVjb25zZW50O1xuXG4gICAgICB0aGlzLmNvbmZpZyA9IGNvbmZpZztcbiAgICAgIC8vIFNldCBjYWxsYmFja3MgaG9va3M6XG4gICAgICB0aGlzLmNvbmZpZy5vblBvcHVwT3BlbiA9XG4gICAgICAgICgpID0+IHRoaXMucG9wdXBPcGVuU291cmNlLm5leHQoKTtcblxuICAgICAgdGhpcy5jb25maWcub25Qb3B1cENsb3NlID1cbiAgICAgICAgKCkgPT4gdGhpcy5wb3B1cENsb3NlU291cmNlLm5leHQoKTtcblxuICAgICAgdGhpcy5jb25maWcub25Jbml0aWFsaXNlID1cbiAgICAgICAgKHN0YXR1czogJ2FsbG93JyB8ICdkZW55JyB8ICdkaXNtaXNzJykgPT4gdGhpcy5pbml0aWFsaXppbmdTb3VyY2UubmV4dCh7IHN0YXR1czogc3RhdHVzIH0pO1xuXG4gICAgICB0aGlzLmNvbmZpZy5vblN0YXR1c0NoYW5nZSA9XG4gICAgICAgIChzdGF0dXM6ICdhbGxvdycgfCAnZGVueScgfCAnZGlzbWlzcycsIGNob3NlbkJlZm9yZTogYm9vbGVhbikgPT4ge1xuICAgICAgICAgIHRoaXMuc3RhdHVzQ2hhbmdlU291cmNlLm5leHQoeyBzdGF0dXM6IHN0YXR1cywgY2hvc2VuQmVmb3JlOiBjaG9zZW5CZWZvcmUgfSk7XG4gICAgICAgIH07XG5cbiAgICAgIHRoaXMuY29uZmlnLm9uUmV2b2tlQ2hvaWNlID1cbiAgICAgICAgKCkgPT4gdGhpcy5yZXZva2VDaG9pY2VTb3VyY2UubmV4dCgpO1xuXG4gICAgICB0aGlzLmNvbmZpZy5vbk5vQ29va2llTGF3ID1cbiAgICAgICAgKGNvdW50cnlDb2RlOiBzdHJpbmcsIGNvdW50cnk6IHN0cmluZykgPT4ge1xuICAgICAgICAgIHRoaXMubm9Db29raWVMYXdTb3VyY2UubmV4dCh7IGNvdW50cnlDb2RlOiBjb3VudHJ5Q29kZSwgY291bnRyeTogY291bnRyeSB9KTtcbiAgICAgICAgfTtcblxuICAgICAgLy8gSW5pdCB0aGUgY29va2llY29uc2VudCBsaWJyYXJ5IHdpdGggaW5qZWN0ZWQgY29uZmlnXG4gICAgICB0aGlzLmNvb2tpZWNvbnNlbnQuaW5pdGlhbGlzZSh0aGlzLmNvbmZpZyxcbiAgICAgICAgKHBvcHVwOiBOZ2NDb29raWVDb25zZW50UG9wdXApID0+IHtcbiAgICAgICAgICB0aGlzLnBvcHVwSW5zdGFuY2UgPSBwb3B1cDtcbiAgICAgICAgICB0aGlzLmluaXRpYWxpemVkU291cmNlLm5leHQoKTsvL25vdGlmeSBvZiBzdWNjZXNzZnVsIGluaXRpYWxpemF0aW9uXG4gICAgICAgIH0sXG4gICAgICAgIChlcnJvcjogRXJyb3IsIHBvcHVwOiBOZ2NDb29raWVDb25zZW50UG9wdXApID0+IHtcbiAgICAgICAgICB0aGlzLmluaXRpYWxpemF0aW9uRXJyb3JTb3VyY2UubmV4dCh7ZXJyb3I6IGVycm9yfSk7Ly9ub3RpZnkgb2YgZmFpbGVkIGluaXRpYWxpemF0aW9uXG4gICAgICAgIH1cbiAgICAgICk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEdldHMgdGhlIGN1cnJlbnQgY29uZmlndXJhdGlvbiAgdXNlZCBieSB0aGUgQ29va2llIENvbnNlbnQuXG4gICAqL1xuICBnZXRDb25maWcoKTogTmdjQ29va2llQ29uc2VudENvbmZpZyB7XG4gICAgcmV0dXJuIHRoaXMuY29uZmlnO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldHMgdGhlIGN1cnJlbnQgY29va2llIHN0YXR1cy5cbiAgICovXG4gIGdldFN0YXR1cygpOiBOZ2NDb29raWVDb25zZW50U3RhdHVzIHtcbiAgICByZXR1cm4gdGhpcy5jb29raWVjb25zZW50LnN0YXR1cztcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXRzIHRoZSBjdXJyZW50IGJyb3dzZXIgc3VwcG9ydCBmb3IgdHJhbnNsYXRpb25zXG4gICAqL1xuICBnZXRUcmFuc2l0aW9uKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLmNvb2tpZWNvbnNlbnQuaGFzVHJhbnNpdGlvbjtcbiAgfVxuXG4gIC8qKlxuICAgKiBDbGVhcnMgdGhlIGN1cnJlbnQgY29va2llIHN0YXR1cy5cbiAgICovXG4gIGNsZWFyU3RhdHVzKCk6IHZvaWQge1xuICAgIHRoaXMuY2hlY2tQb3B1cEluc3RhbnRpYXRlZCgnY2xlYXJTdGF0dXMnKTtcbiAgICByZXR1cm4gdGhpcy5wb3B1cEluc3RhbmNlLmNsZWFyU3RhdHVzKCk7XG4gIH1cblxuICBvcGVuKCk6IE5nY0Nvb2tpZUNvbnNlbnRQb3B1cCB7XG4gICAgdGhpcy5jaGVja1BvcHVwSW5zdGFudGlhdGVkKCdvcGVuJyk7XG4gICAgcmV0dXJuIHRoaXMucG9wdXBJbnN0YW5jZS5vcGVuKCk7XG4gIH1cblxuICBjbG9zZShzaG93UmV2b2tlOiBib29sZWFuKTogTmdjQ29va2llQ29uc2VudFBvcHVwIHtcbiAgICB0aGlzLmNoZWNrUG9wdXBJbnN0YW50aWF0ZWQoJ2Nsb3NlJyk7XG4gICAgcmV0dXJuIHRoaXMucG9wdXBJbnN0YW5jZS5jbG9zZShzaG93UmV2b2tlKTtcbiAgfVxuXG4gIGRlc3Ryb3koKTogdm9pZCB7XG4gICAgdGhpcy5jaGVja1BvcHVwSW5zdGFudGlhdGVkKCdkZXN0cm95Jyk7XG4gICAgdGhpcy5wb3B1cEluc3RhbmNlLmRlc3Ryb3koKTtcbiAgfVxuXG4gIGZhZGVJbigpOiB2b2lkIHtcbiAgICB0aGlzLmNoZWNrUG9wdXBJbnN0YW50aWF0ZWQoJ2ZhZGVJbicpO1xuICAgIHRoaXMucG9wdXBJbnN0YW5jZS5mYWRlSW4oKTtcbiAgfVxuXG4gIGZhZGVPdXQoKTogdm9pZCB7XG4gICAgdGhpcy5jaGVja1BvcHVwSW5zdGFudGlhdGVkKCdmYWRlT3V0Jyk7XG4gICAgdGhpcy5wb3B1cEluc3RhbmNlLmZhZGVPdXQoKTtcbiAgfVxuXG4gIGlzT3BlbigpOiBib29sZWFuIHtcbiAgICB0aGlzLmNoZWNrUG9wdXBJbnN0YW50aWF0ZWQoJ2lzT3BlbicpO1xuICAgIHJldHVybiB0aGlzLnBvcHVwSW5zdGFuY2UuaXNPcGVuKCk7XG4gIH1cblxuICB0b2dnbGVSZXZva2VCdXR0b24oc2hvdzogYm9vbGVhbik6IHZvaWQge1xuICAgIHRoaXMuY2hlY2tQb3B1cEluc3RhbnRpYXRlZCgndG9nZ2xlUmV2b2tlQnV0dG9uJyk7XG4gICAgdGhpcy5wb3B1cEluc3RhbmNlLnRvZ2dsZVJldm9rZUJ1dHRvbihzaG93KTtcbiAgfVxuXG4gIGhhc0Fuc3dlcmVkKCk6IGJvb2xlYW4ge1xuICAgIHRoaXMuY2hlY2tQb3B1cEluc3RhbnRpYXRlZCgnaGFzQW5zd2VyZWQnKTtcbiAgICByZXR1cm4gdGhpcy5wb3B1cEluc3RhbmNlLmhhc0Fuc3dlcmVkKCk7XG4gIH1cblxuICBoYXNDb25zZW50ZWQoKTogYm9vbGVhbiB7XG4gICAgdGhpcy5jaGVja1BvcHVwSW5zdGFudGlhdGVkKCdoYXNDb25zZW50ZWQnKTtcbiAgICByZXR1cm4gdGhpcy5wb3B1cEluc3RhbmNlLmhhc0NvbnNlbnRlZCgpO1xuICB9XG59XG4iXX0=